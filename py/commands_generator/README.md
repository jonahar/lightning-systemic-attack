## Commands Generator

The `commands_generator` package is responsible for generating lightning simulations code,
mainly for executing our proposed attack.

To run many different simulations, we need a framework that is general and easy
to understand, but also allows flexibility in tweaking different parts of a 
simulation. Our framework consists of a collection of python modules that generate
bash code that runs lightning simulations. The python modules are organized in an
object-oriented and modular way and are easy to read and explore. To create the
simulation code, we run the `commands_generator` module with all the desired 
parameters (topology, number of payments, bitcoin's network parameters, etc.).
Run with `--help` to see all supported arguments. The result of `commands_generator` is
a single bash file with all the commands, written **sequentially**. This way we can
easily change and explore different parts in a simulation, run only part of the commands,
or even run them at a custom order.



## Resources allocation
Each node in a simulation needs to use unique ports (listen, rpc...) and 
paths (datadir). To run multiple simulations on a single machine at the same time,
we must carefully allocate such resources to different nodes, so each node gets
unique values. The `resources_allocator` module is responsible for this job.

Each simulation is associated with a number, that affects the values allocated 
to nodes in that simulation. Due to port number constraints, a simulation number
must be between 1 and 5. See the documentation of `ResourcesAllocator` for more 
details.



## CLI functions
The commands generated by `CommandsGenerator` are quite cumbersome and include many
flags, long absolute paths and different port numbers.
Sometimes we want to easily interact with nodes while the simulation is running
(query for their state, known channels, peers, blockchain stats, etc.). For that
we have a few useful cli functions for interacting with the nodes while a 
simulation is running. To use them just source the `cli-functions` file and 
provide a simulation number:
```
. $LN/sh/cli-functions <SIMULATION_NUMBER>
```

Then we can effortlessly run bitcoin/lightning commands.

For instance, to list the channels of an LND node with index 4 running in 
simulation 3, instead of writing 
```
$LN/bin/lncli  --rpcserver localhost:31004  --lnddir /tmp/lightning-simulations/3/lightning-datadirs/4  --no-macaroons listchannels
```
We can simply `lncli 4 listchannels`


In general, we can write lightning commands in the following way:
```
lcli 1 COMMAND  # run COMMAND on c-lightning node with index 1
lncli 2 COMMAND # run COMMAND on LND node with index 2
ecli 3 COMMAND  # run COMMAND on Eclair node with index 3
```

Bitcoin-core commands:
```
bcli 0 COMMAND # run bitcoin core's COMMAND on the node with index 0 (the miner node)
bcli 1 COMMAND # run bitcoin core's COMMAND on node with index 1
```

Blockchain info/actions:
```
gettransaction TXID  # retrieve transaction with the given txid
getblock H           # retrieve block with height H
mine X               # tell the miner node (with index 0) to mine X blocks
stat N               # print blockchain height and mempool size for nodes 0-N
```
