#!/usr/bin/env bash

# before running this script make sure:
#   1. the LNPATH variable was set
#   2. all daemons/clis directories are in PATH


cd $(dirname $0)

source cli-functions


# set conf files
mkdir -p "$HOME/.bitcoin" && ln -s -f "$LNPATH/conf/bitcoin.conf" "$HOME/.bitcoin/bitcoin.conf"


kill-daemons


# lightning nodes are sleeping to avoid race condition with bitcoind
tmux new-session -d -n btc-daemon "bash -i -c 'bitcoind'"
tmux new-window -n a-lnd "bash -i -c 'sleep 1; run-lightningd 1'"
tmux new-window -n b-lnd "bash -i -c 'sleep 1; run-lightningd 2'"
tmux new-window -n c-lnd "bash -i -c 'sleep 1; run-lightningd 3 --evil'"
tmux new-window -n cli

tmux select-window -t 4 # select active window
tmux attach-session
